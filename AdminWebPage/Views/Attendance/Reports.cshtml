@model List<AdminWebPage.Models.AttendanceReportViewModel>

<h2>Attendance Report</h2>

<form method="get" class="row g-3 mb-3">
    <div class="col-md-4">
        <label>Start Date</label>
        <input type="date" name="startDate" class="form-control" required />
    </div>
    <div class="col-md-4">
        <label>End Date</label>
        <input type="date" name="endDate" class="form-control" required />
    </div>
    <div class="col-md-4 align-self-end">
        <button type="submit" class="btn btn-primary">Generate Report</button>
    </div>
</form>

@if (Model.Any())
{
    <!-- Print Button -->
    <div class="mb-3">
        <button class="btn btn-success" onclick="printReport()">Print Report</button>
    </div>

    <!-- Report Content Wrapper -->
    <div id="reportContent">
        <!-- Header Image -->
        <div class="text-center mb-3">
            <img src="~/image/mkaHeader.png" alt="MKA Header" class="img-fluid" />
        </div>

        <!-- Summary Section -->
        <div class="card mb-3">
            <div class="card-header bg-light"><strong>Summary</strong></div>
            <div class="card-body">
                <table class="table table-bordered">
                    <thead>
                        <tr>
                            <th>Total Students</th>
                            <th>Present</th>
                            <th>Absent</th>
                            <th>Late</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>@Model.Sum(m => m.TotalStudents)</td>
                            <td>@Model.Sum(m => m.PresentCount)</td>
                            <td>@Model.Sum(m => m.AbsentCount)</td>
                            <td>@Model.Sum(m => m.LateCount)</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Detailed List Section -->
        <div class="card mb-3">
            <div class="card-header bg-light"><strong>Detailed Attendance</strong></div>
            <div class="card-body">
                <table class="table table-bordered">
                    <thead>
                        <tr>
                            <th>Date</th>
                            <th>First Name</th>
                            <th>Middle Name</th>
                            <th>Last Name</th>
                            <th>Remarks</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var item in (List<dynamic>)ViewBag.DetailedList)
                        {
                            <tr>
                                <td>@item.Date</td>
                                <td>@item.FName</td>
                                <td>@item.MName</td>
                                <td>@item.LName</td>
                                <td>@item.Remarks</td>
                            </tr>
                        }
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <script>
        function printReport() {
            var printContents = document.getElementById('reportContent').innerHTML;
            var originalContents = document.body.innerHTML;

            document.body.innerHTML = printContents;
            window.print();
            document.body.innerHTML = originalContents;
            location.reload(); // reload page to restore JS functionality
        }
    </script>
}
else
{
    <p class="text-muted">Please select a date range to view the report.</p>
}
